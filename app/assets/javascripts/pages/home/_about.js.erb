/* global $ */

$( document ).on('turbolinks:load', function() {
  var about = 'section#about';
    var hero = about + ' div#about-hero';
    var pull = about + ' div#about-pull';
      var pullHandle = pull + ' div#about-pull-handle';
      var pullTondo = pull + ' div#about-pull-tondo';
      var pullContent = pull + ' div#about-pull-content';
        var pullTease = pullContent + ' div#about-pull-tease';
        var pullInfo = pullContent + ' div#about-pull-info';
        var pullSummary = pullContent + ' div#about-pull-summary';
      var pullBreadcrumbs = pull + ' div#about-pull-breadcrumbs';
        var pullBreadcrumb = pullBreadcrumbs + ' span';
    var contact = about + ' a#about-contact';
  
  var $about = $(about);
    var $hero = $(hero);
    var $pull = $(pull);
      var $pullHandle = $(pullHandle);
      var $pullTondo = $(pullTondo);
      var $pullContent = $(pullContent);
        var $pullTease = $(pullTease);
        var $pullInfo = $(pullInfo);
        var $pullSummary = $(pullSummary);
      var $pullBreadCrumbs = $(pullBreadcrumbs);
    var $contact = $(contact);
  
  var content = [
    {
      tease: 'I AM GRIZ',
      info: 'I enjoy creating beautifully designed experiences',
      summary: 'Contact me for your next website or job',
      tondo: '<%= asset_path "bear.jpg" %>',
    },
    {
      tease: 'MILLIE THE PUP',
      info: 'Rescued and sassy, she loves playing with bones and howling at strangers',
      summary: 'Will demand play before cuddles',
      tondo: '<%= asset_path "millie.jpg" %>',
    },
    {
      tease: 'MY BESTFRIEND',
      info: 'Going strong for 7 years, I\'m the luckiest guy alive to have Leigh',
      summary: 'I love spending everyday with her',
      tondo: '<%= asset_path "leigh.jpg" %>',
    },
  ];
    
  $pullBreadCrumbs.html('<span class="active"></span>');
  
  content.forEach(function(val, i) {
    if (i > 0) {
      $pullBreadCrumbs.append('<span></span>');
    }
  });
  
  var $pullBreadcrumb = $(pullBreadcrumb);
  
  var $responsive = $([pullHandle, contact, pullTondo, pullBreadcrumb].join(', '));
  
  var sectionFill = function() {
    $about.css({
      'height': $( window ).height(),
    });
  };
  
  sectionFill();
  
  var tondoFocus = function() {
    var windowHeight = $( window ).height();
    var windowWidth =  $( window ).width();
    
    if (windowHeight > windowWidth) {
      $pullTondo.css({
        height: windowWidth - 30,
        width: windowWidth - 30,
        top: $( window ).height() / 2 - windowWidth / 2 - $pull.offset().top + 15 - 4,
        right: 15 - 4,
      });
    } else {
      $pullTondo.css({
        height: windowHeight - 30,
        width: windowHeight - 30,
        top: 15 - 4 - $pull.offset().top,
        right: $( window ).width() / 2 - windowHeight / 2 + 15 - 4,
      });
    }
  };
  
  var tondoUnfocus = function() {
    var windowWidth =  $( window ).width();
    
    $pullTondo.css({
      height: windowWidth / 5,
      width: '',
      top: (-windowWidth / 10),
      right: '',
    });
  };
  
  tondoUnfocus();
  
  $( window ).resize(function() {
    sectionFill();
    if ($pullTondo.hasClass('focus')) {
      tondoFocus();
    } else {
      tondoUnfocus();
    }
  });
  
  var togglePull = function() {
    if ($(this).hasClass('mousedown')) {
      $pullHandle.removeClass('mousedown hover');
      
      if ($pull.hasClass('show')) {
        $pull.removeClass('show');
        $pullHandle.html('<span>></span>');
        $hero.removeClass('shrink');
      } else {
        $pull.addClass('show');
        $pullHandle.html('<span><</span>');
        $hero.addClass('shrink');
      }
    }
  };
  
  var toggleTondo = function() {
    if ($pullTondo.hasClass('mousedown')) {
      $pullTondo.removeClass('mousedown hover');
      
      if ($pullTondo.hasClass('focus')) {
        $pullTondo.removeClass('focus');
        tondoUnfocus();
      } else {
        $pullTondo.addClass('focus');
        tondoFocus();
      }
    }
  };
  
  var setContent = function(index) {
    var newContent = content[index];
    $pullTease.html('<span>' + newContent.tease + '</span>');
    $pullInfo.html('<span>' + newContent.info + '</span>');
    $pullSummary.html('<span>' + newContent.summary + '</span>');
  
    $pullTondo.css({
      backgroundImage: 'url(' + newContent.tondo + ')',
    });
  };
  
  setContent(0);
  
  var updateContent = function() {
    if ($(this).hasClass('mousedown')) {
      $(this).removeClass('mousedown hover');
      
      if (!$(this).hasClass('active')) {
        setContent($(this).index());
        $pullBreadcrumb.removeClass('active');
        $(this).addClass('active');
      }
    }
  };
  
  $responsive.on('mousedown', function() {
    $(this).addClass('mousedown');
  });
  
  $pullHandle.on('mouseup touchend touchcancel', togglePull);
  
  // Screen actually follows link when mouseup event used instead of click
  $contact.on('click touchend touchcancel', function(e) {
    e.preventDefault();
    
    $contact.removeClass('mousedown hover');
    
    $('html, body').on('scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove', function() {
      $('html, body').stop();
      $('html, body').off('scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove');
    });
    
    var top = $('#contact').offset().top;
    var border = parseInt($('#contact').css("border-top-width"));
    $('html, body').animate({scrollTop: top + border}, 3000, function() {
      $('html, body').off('scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove');
    });
    
    return false;
  });
  
  $pullTondo.on('mouseup touchend touchcancel', toggleTondo);
  
  $pullBreadcrumb.on('mouseup touchend touchcancel', updateContent);
  
  $responsive.on('mouseenter', function() {
    $(this).addClass('hover');
  });
  
  $responsive.on('mouseleave', function() {
    $(this).removeClass('hover mousedown');
  });
  
  $responsive.on('touchstart', function(e) {
    e.preventDefault();
    $(this).addClass('mousedown');
  });
});
